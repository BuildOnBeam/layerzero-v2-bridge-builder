-include .env

###########################################################
############# 		BRIDGE TOKENS	(E2E tests!)###########
###########################################################

run-bridge-token:
	@forge script $(BRIDGE_SCRIPT_PATH) \
		--rpc-url $(RPC_URL) \
		--broadcast \
		--account ${ACCOUNT_NAME} \
		--password $(ACCOUNT_PWD) \
		--sig "$(BRIDGE_TOKEN_SIG)"  $(CHAIN_ID) $(CONTRACT) \
		-vvvvvvv --legacy 
	
# make test-bridge RPC_URL=https://ethereum-sepolia-rpc.publicnode.com ACCOUNT_NAME=beam-test-1 CONTRACT=0x40f76105e01fbCA5fDc9E8897E7B69Fa71550C9d CHAIN_ID=13337
# make test-bridge RPC_URL=https://build.onbeam.com/rpc/testnet ACCOUNT_NAME=beam-test-1 CONTRACT=0x87ceb22aC24FB14C4f3191C8DB974A0Be41e0aB8 CHAIN_ID=11155111
# the chain id is the destination chain id
test-bridge: 
	$(MAKE) run-bridge-token RPC_URL=${RPC_URL} ACCOUNT_NAME=${ACCOUNT_NAME} CHAIN_ID=${CHAIN_ID} CONTRACT=$(CONTRACT)


###########################################################
############# 	BRIDGE TOKENS	(unit tests!)    ##########
###########################################################

test-foundry-oft-adapter:
	@forge clean
	@echo "testing oft adapter"
	@forge test --match-path test/foundry/BeamOFTAdapter.t.sol --force $(VERBOSE)

test-foundry-oft-adapter-permit:
	@forge clean
	@echo "testing oft permit"
	@forge test --match-path test/foundry/BeamOFTPermit.t.sol --force $(VERBOSE)

test-foundry-oft-fees:
	@forge clean
	@echo "testing oft permit"
	@forge test --match-path test/foundry/BeamOFTFees.t.sol --force $(VERBOSE)


coverage:
	@forge clean
	@echo "checking test coverage"
	forge clean && forge coverage --via-ir --ir-minimum
